<!-- 文章详情页布局 -->

<%
/* 获取文章封面图 */
var covers = theme.cover.default_post_covers || [];
var coverIndex = page.title ? page.title.length % covers.length : 0;
var postCover = page.cover || covers[coverIndex] || theme.cover.home_bg;
%>

<!-- 文章顶部横幅 -->
<section class="post-banner" style="background-image: url('<%= postCover %>')">
  <div class="hero-overlay"></div>
  <div class="post-banner-content">
    <!-- 分类 -->
    <% if (page.categories && page.categories.length) { %>
      <div class="post-banner-cats">
        <% page.categories.forEach(function(cat) { %>
          <a href="<%- url_for(cat.path) %>"><i class="fas fa-folder"></i> <%= cat.name %></a>
        <% }) %>
      </div>
    <% } %>
    <h1 class="post-banner-title"><%= page.title %></h1>
    <div class="post-banner-meta">
      <span><i class="far fa-calendar-alt"></i> <%= date(page.date, 'YYYY-MM-DD') %></span>
      <span><i class="far fa-clock"></i> 阅读约 <%= wordcount(page.content) %> 字</span>
      <% if (page.tags && page.tags.length) { %>
        <span><i class="fas fa-tags"></i>
          <% var tagArr = []; page.tags.forEach(function(tag){ tagArr.push(tag.name); }); %>
          <%= tagArr.join(' / ') %>
        </span>
      <% } %>
    </div>
  </div>
</section>

<!-- 文章主体 -->
<div class="container post-container">
  <div class="post-layout">
    <!-- 文章内容区域 -->
    <article class="post-content-wrap">
      <!-- 目录（TOC） -->
      <% if (theme.post.toc && toc(page.content)) { %>
        <div class="post-toc-mobile" id="toc-mobile">
          <details>
            <summary><i class="fas fa-list"></i> 文章目录</summary>
            <div class="toc-content"><%- toc(page.content, { list_number: false }) %></div>
          </details>
        </div>
      <% } %>

      <!-- 正文 -->
      <div class="post-body markdown-body">
        <%- page.content %>
      </div>

      <!-- 版权声明 -->
      <% if (theme.post.copyright) { %>
        <div class="post-copyright">
          <p><strong><i class="fas fa-copyright"></i> 版权声明</strong></p>
          <p>本文作者：<%= config.author %></p>
          <p>本文链接：<a href="<%- config.url + url_for(page.path) %>"><%= config.url + url_for(page.path) %></a></p>
          <p>除特别声明外，本站所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</p>
        </div>
      <% } %>

      <!-- 文章标签 -->
      <% if (page.tags && page.tags.length) { %>
        <div class="post-tags">
          <% page.tags.forEach(function(tag) { %>
            <a href="<%- url_for(tag.path) %>" class="tag-item">
              <i class="fas fa-hashtag"></i><%= tag.name %>
            </a>
          <% }) %>
        </div>
      <% } %>

      <!-- 上一篇 / 下一篇导航 -->
      <nav class="post-nav">
        <% if (page.prev) { %>
          <a href="<%- url_for(page.prev.path) %>" class="post-nav-item prev">
            <span class="post-nav-label"><i class="fas fa-chevron-left"></i> 上一篇</span>
            <span class="post-nav-title"><%= page.prev.title %></span>
          </a>
        <% } else { %>
          <span class="post-nav-item prev disabled"></span>
        <% } %>
        <% if (page.next) { %>
          <a href="<%- url_for(page.next.path) %>" class="post-nav-item next">
            <span class="post-nav-label">下一篇 <i class="fas fa-chevron-right"></i></span>
            <span class="post-nav-title"><%= page.next.title %></span>
          </a>
        <% } else { %>
          <span class="post-nav-item next disabled"></span>
        <% } %>
      </nav>

      <!-- 评论区 -->
      <%- partial('_partial/comment') %>
    </article>

    <!-- 侧边栏目录（桌面端） -->
    <% if (theme.post.toc && toc(page.content)) { %>
      <aside class="post-sidebar" id="post-sidebar">
        <div class="sidebar-toc">
          <h3><i class="fas fa-list"></i> 文章目录</h3>
          <div class="toc-content"><%- toc(page.content, { list_number: false }) %></div>
        </div>
      </aside>
    <% } %>
  </div>
</div>
